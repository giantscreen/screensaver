<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clever</title>
<link rel="icon" type="image/png" href="/favicon.png" />
<style>
  html,body{
    height:100%;
    margin:0;
    background:#000;
    overflow:hidden;
    user-select:none;
    font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:#fff;
  }
  #hint{
    position:fixed;
    left:12px;
    bottom:12px;
    color:#aaa;
    font-size:12px;
    opacity:0.85;
    z-index:3;
  }
  #linkIndicator{
    position:fixed;
    right:6px;
    bottom:4px;
    font-size:9px;
    color:#222;
    opacity:0.6;
    pointer-events:none;
    z-index:3;
  }
  #screensaver{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    z-index:1;
    display:none;
  }
  .mode1{
    background: radial-gradient(circle at center, #ff00ff, #000);
    animation: pulse 6s infinite alternate ease-in-out;
  }
  @keyframes pulse {
    0%{filter:blur(0px) brightness(1);}
    100%{filter:blur(20px) brightness(1.8);}
  }
  .mode2{
    background: linear-gradient(45deg,#00f,#0ff,#0f0,#ff0,#f00);
    background-size:400% 400%;
    animation: shift 10s infinite linear;
  }
  @keyframes shift{
    0%{background-position:0% 0%;}
    50%{background-position:100% 100%;}
    100%{background-position:0% 0%;}
  }
  .mode3{
    background:conic-gradient(from 0deg,#f00,#ff0,#0f0,#0ff,#00f,#f0f,#f00);
    animation: spin 12s infinite linear;
  }
  @keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
  }
  canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
  }
</style>
</head>
<body>

<div id="hint">Saving your screen from falling asleep!</div>
<div id="linkIndicator"></div>
<div id="screensaver"></div>

<script>
(function(){

  const SECRETS = [
    { code: "g1", newTab: "https://gn-math.dev/" },
    { code: "g2", newTab: "https://novamath.net/" },
    { code: "g3", newTab: "https://kbhgames.com/" }
  ];

  const REPLACEMENTS = [
    "https://www.clever.com",
    "https://wwhs.echo-ntn.org",
    "about:blank"
  ];

  function mapTitle(url){
    if(url === "https://www.clever.com") return "Clever";
    if(url === "https://wwhs.echo-ntn.org") return "Buzz";
    if(url === "about:blank") return "about:blank";
    return "Redirecting";
  }

  let i = parseInt(localStorage.getItem("selectedLinkIndex")) || 0;
  let REPLACE_TARGET = REPLACEMENTS[i];

  const indicator = document.getElementById('linkIndicator');
  indicator.textContent = REPLACE_TARGET;
  document.title = mapTitle(REPLACE_TARGET);

  const saver = document.getElementById("screensaver");

  const modes = ["mode1","mode2","mode3","galaxy"];
  let active = false;

  function getRandomMode(){
    return modes[Math.floor(Math.random()*modes.length)];
  }

  let galaxyCanvas = null;
  let galaxyCtx = null;
  let stars = [];

  function startGalaxy(){
    galaxyCanvas = document.createElement("canvas");
    saver.appendChild(galaxyCanvas);
    galaxyCtx = galaxyCanvas.getContext("2d");

    function resize(){
      galaxyCanvas.width = window.innerWidth;
      galaxyCanvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    const numStars = 250;
    stars = [];
    for(let i=0;i<numStars;i++){
      stars.push({
        x: Math.random()*galaxyCanvas.width,
        y: Math.random()*galaxyCanvas.height,
        z: Math.random()*3 + 0.2
      });
    }

    function animate(){
      if(!active || saver.dataset.mode!=="galaxy") return;

      galaxyCtx.fillStyle = "black";
      galaxyCtx.fillRect(0,0,galaxyCanvas.width,galaxyCanvas.height);

      for(const s of stars){
        galaxyCtx.fillStyle = "white";
        galaxyCtx.fillRect(s.x, s.y, s.z, s.z);

        s.x += (s.x - galaxyCanvas.width/2) * 0.002;
        s.y += (s.y - galaxyCanvas.height/2) * 0.002;

        if(s.x < 0 || s.x > galaxyCanvas.width || s.y < 0 || s.y > galaxyCanvas.height){
          s.x = Math.random()*galaxyCanvas.width;
          s.y = Math.random()*galaxyCanvas.height;
        }
      }

      requestAnimationFrame(animate);
    }

    animate();
  }

  function stopGalaxy(){
    saver.innerHTML = "";
    galaxyCanvas = null;
    galaxyCtx = null;
    stars = [];
  }

  function enableScreensaver(){
    active = true;
    saver.style.display = "block";

    const m = getRandomMode();
    saver.dataset.mode = m;

    if(m !== "galaxy"){
      saver.className = m;
      stopGalaxy();
    } else {
      saver.className = "";
      startGalaxy();
    }
  }

  function disableScreensaver(){
    active = false;
    saver.style.display = "none";
    saver.className = "";
    saver.dataset.mode = "";
    stopGalaxy();
  }

  disableScreensaver();

  const buffer = [];
  const MAX_BUFFER = 60;
  function norm(k){ return k ? k.toLowerCase() : ""; }

  function findSecret(){
    for(const s of SECRETS){
      const seq = s.code.split("");
      if(buffer.length < seq.length) continue;
      let ok = true;
      for(let j=0;j<seq.length;j++){
        if(buffer[buffer.length - seq.length + j] !== seq[j]){ ok=false; break; }
      }
      if(ok) return s;
    }
    return null;
  }

  function checkSaverSequence(){
    const seq = "saver".split("");
    if(buffer.length < seq.length) return false;
    for(let j=0;j<seq.length;j++){
      if(buffer[buffer.length - seq.length + j] !== seq[j]) return false;
    }
    return true;
  }

  function openCloakedTab(target){
    let tab = null;
    try{
      tab = window.open("about:blank","_blank");
      if(!tab){ window.open(target,"_blank"); return; }
      const html = '<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>html,body{margin:0;height:100%;background:#000}iframe{border:0;width:100%;height:100%}</style></head><body><iframe src="'+target+'" sandbox="allow-forms allow-scripts allow-same-origin allow-popups"></iframe></body></html>';
      tab.document.open();
      tab.document.write(html);
      tab.document.close();
    }catch(e){
      window.open(target,"_blank");
    }
  }

  function trigger(secret){
    if(secret && secret.newTab) openCloakedTab(secret.newTab);
    document.documentElement.style.visibility = "hidden";
    setTimeout(()=>location.replace(REPLACE_TARGET),250);
  }

  window.addEventListener("keydown", e=>{
    const k = norm(e.key);
    if(!k) return;

    if(k === "l"){
      i = (i + 1) % REPLACEMENTS.length;
      localStorage.setItem("selectedLinkIndex", i);
      REPLACE_TARGET = REPLACEMENTS[i];
      indicator.textContent = REPLACE_TARGET;
      document.title = mapTitle(REPLACE_TARGET);
      return;
    }

    buffer.push(k);
    if(buffer.length > MAX_BUFFER) buffer.shift();

    if(checkSaverSequence()){
      if(active) disableScreensaver();
      else enableScreensaver();
      buffer.length = 0;
      return;
    }

    const match = findSecret();
    if(match){
      trigger(match);
      buffer.length = 0;
    }
  });

  setTimeout(()=>{ const h=document.getElementById("hint"); if(h) h.style.display = "none"; },3500);
})();
</script>

</body>
</html>
