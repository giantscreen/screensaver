function cloak() {
  try {
    if (MODE === "new-tab") {
      // open about:blank first
      const newTab = window.open("about:blank", "_blank");
      if (newTab) {
        try {
          newTab.document.write(`
            <!doctype html>
            <html>
            <head><meta charset="utf-8"><title> </title>
              <style>
                html,body{margin:0;height:100%;overflow:hidden;background:#000;}
                iframe{border:0;width:100%;height:100%;}
              </style>
            </head>
            <body>
              <iframe src="${TARGET_URL}" allowfullscreen></iframe>
            </body>
            </html>
          `);
          newTab.document.close();
          newTab.focus();
        } catch (e) {
          try { newTab.location.href = TARGET_URL; } catch (e) {}
        }
      } else {
        window.location.href = TARGET_URL;
      }
    } 
    else if (MODE === "replace") {
      // replace current tab content with about:blank cloak
      const html = `
        <!doctype html>
        <html>
        <head><meta charset="utf-8"><title> </title>
          <style>
            html,body{margin:0;height:100%;overflow:hidden;background:#000;}
            iframe{border:0;width:100%;height:100%;}
          </style>
        </head>
        <body>
          <iframe src="${TARGET_URL}" allowfullscreen></iframe>
        </body>
        </html>
      `;
      document.open();
      document.write(html);
      document.close();
    }

    if (HIDE_AFTER_TRIGGER) {
      document.documentElement.style.visibility = "hidden";
    }
  } catch (err) {
    try { window.location.href = TARGET_URL; } catch (e) {}
  }
}
